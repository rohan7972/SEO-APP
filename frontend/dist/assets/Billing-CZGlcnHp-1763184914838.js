import{j as e}from"./app-bridge-Dll4AwN--1763184914838.js";import{r as i}from"./react-vendor-tAaa2TlE-1763184914838.js";import{L as l,C as m,B as j,a as o,n as re,T as r,v as ae,w as $,x as Y,d as y,I as w,f as se,D as B,b as I,M as S,y as ie,h as oe}from"./polaris-DkgsK6SL-1763184914838.js";const U=[10,20,50,100];function ue({shop:x}){var z,G,N;const[q,W]=i.useState(!0),[c,H]=i.useState(null),[p,L]=i.useState(null),[J,v]=i.useState(!1),[K,T]=i.useState(!1),[_,k]=i.useState(!1),[b,P]=i.useState(""),[A,C]=i.useState(U[0]),[M,f]=i.useState(!1),[D,h]=i.useState(null),[F,E]=i.useState(!1),[V,R]=i.useState(!1),[Q,X]=i.useState(!1),O=i.useCallback(async()=>{var n;try{W(!0),h(null);const a=await fetch(`/api/billing/info?shop=${x}`,{headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const s=await a.json();H(s),(((n=s.subscription)==null?void 0:n.status)==="pending"||!s.subscription)&&R(!0)}catch(a){console.error("[Billing] Error fetching info:",a),h("Failed to load billing information")}finally{W(!1)}},[x]);i.useEffect(()=>{const n=new URLSearchParams(window.location.search);if(n.get("success")==="true"){const a=n.get("host"),s=n.get("embedded");if(X(!0),a&&s){const d=`/dashboard?shop=${encodeURIComponent(x)}&embedded=${s}&host=${encodeURIComponent(a)}`;window.location.href=d}}else O()},[O,x]);const Z=async n=>{try{f(!0),h(null),R(!1);const a=await fetch("/api/billing/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:x,plan:n,endTrial:F})}),s=await a.json();if(!a.ok)throw new Error(s.error||"Failed to create subscription");s.confirmationUrl&&(window.top.location.href=s.confirmationUrl)}catch(a){console.error("[Billing] Subscribe error:",a),h(a.message)}finally{f(!1),v(!1),E(!1)}},ee=async n=>{try{f(!0),h(null);const s=new URLSearchParams(window.location.search).get("returnTo")||"/billing",d=await fetch("/api/billing/tokens/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:x,amount:parseFloat(n),returnTo:s})}),g=await d.json();if(!d.ok)throw new Error(g.error||"Failed to purchase tokens");g.confirmationUrl&&(window.top.location.href=g.confirmationUrl)}catch(a){console.error("[Billing] Purchase error:",a),h(a.message)}finally{f(!1),T(!1)}},ne=n=>{const d=n*.3/.16;return Math.floor(d*1e6)};if(Q)return e.jsx(l,{children:e.jsx(l.Section,{children:e.jsx(m,{children:e.jsx(j,{padding:"800",children:e.jsxs(o,{gap:"400",align:"center",children:[e.jsx(re,{size:"large"}),e.jsx(r,{variant:"headingMd",alignment:"center",children:"Plan Activated Successfully! ðŸŽ‰"}),e.jsx(r,{variant:"bodyMd",tone:"subdued",alignment:"center",children:"Redirecting to your Dashboard..."})]})})})})});if(q)return e.jsx(ae,{title:"Plans & Billing",primaryAction:!0,children:e.jsxs(l,{children:[e.jsx(l.Section,{children:e.jsx(m,{children:e.jsxs(o,{gap:"400",children:[e.jsx($,{size:"small"}),e.jsx(Y,{lines:3})]})})}),e.jsx(l.Section,{children:e.jsx(m,{children:e.jsxs(o,{gap:"400",children:[e.jsx($,{size:"medium"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[1,2,3,4].map(n=>e.jsx(m,{children:e.jsxs(o,{gap:"200",children:[e.jsx($,{size:"small"}),e.jsx(Y,{lines:5})]})},n))})]})})})]})});const t=c==null?void 0:c.subscription,u=c==null?void 0:c.tokens,te=((c==null?void 0:c.plans)||[]).filter(n=>!["starter","growth"].includes(n.key));return e.jsxs(e.Fragment,{children:[e.jsxs(l,{children:[D&&e.jsx(l.Section,{children:e.jsx(y,{title:"Error",tone:"critical",onDismiss:()=>h(null),children:e.jsx("p",{children:D})})}),V&&e.jsx(l.Section,{children:e.jsx(y,{title:"ðŸ¤– Future-Proof Your Product Discovery",tone:"success",onDismiss:()=>R(!1),children:e.jsxs(o,{gap:"200",children:[e.jsx("p",{children:"Traditional SEO isn't enough anymore. AI assistants like ChatGPT, Gemini & Perplexity need structured data to recommend your products."}),e.jsx("p",{children:"indexAIze transforms your product data into structured formats optimized for AI search engines, making it easy for ChatGPT, Gemini, Perplexity and others to find and recommend your products."}),e.jsxs("p",{children:[e.jsx("strong",{children:"âœ… Smart approach:"})," Start with a smaller plan to test optimization. Upgrade anytime to scale across your entire catalog."]})]})})}),(t==null?void 0:t.inTrial)&&e.jsx(l.Section,{children:e.jsx(y,{title:"Trial Period Active",tone:"info",action:{content:"Activate Plan",onAction:async()=>{try{f(!0),h(null);const n=await fetch("/api/billing/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shop:x,endTrial:!0})}),a=await n.json();if(!n.ok)throw new Error(a.error||"Failed to activate plan");if(a.requiresApproval&&a.confirmationUrl){window.top.location.href=a.confirmationUrl;return}const s=Date.now();window.location.href=`/billing?shop=${encodeURIComponent(x)}&_t=${s}&embedded=${new URLSearchParams(window.location.search).get("embedded")}&host=${encodeURIComponent(new URLSearchParams(window.location.search).get("host")||"")}`}catch(n){console.error("[Billing] Activation error:",n),h(n.message)}finally{f(!1)}}},children:e.jsxs("p",{children:["Trial ends on ",new Date(t.trialEndsAt).toLocaleDateString(),". Advanced AI features are locked during trial. Activate your ",t.plan," plan to use them now."]})})}),e.jsx(l.Section,{children:e.jsx(m,{children:e.jsx(o,{gap:"400",children:e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:te.map(n=>{var a;return e.jsx(m,{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",minHeight:"400px",gap:"12px"},children:[e.jsxs(w,{align:"space-between",blockAlign:"center",children:[e.jsx(r,{variant:"headingMd",children:n.name}),(t==null?void 0:t.plan)===n.key&&(t==null?void 0:t.status)==="active"&&e.jsx(se,{tone:"success",children:"Current"})]}),n.badge&&e.jsx(r,{variant:"bodySm",tone:"subdued",fontWeight:"medium",children:n.badge}),e.jsxs(r,{variant:"heading2xl",children:["$",n.price]}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"per month"}),e.jsx(B,{}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Optimize up to ",e.jsx("strong",{children:((a=n.productLimit)==null?void 0:a.toLocaleString())||"N/A"})," products in up to ",e.jsx("strong",{children:n.languageLimit||1})," ",n.languageLimit===1?"language":"languages"]}),n.features&&n.features.length>0&&e.jsxs(j,{children:[e.jsx(r,{variant:"bodySm",fontWeight:"semibold",children:"Features:"}),e.jsx(o,{gap:"100",children:n.features.map((s,d)=>e.jsx(r,{variant:"bodySm",tone:"subdued",children:s.startsWith("All from")||s.startsWith("âœ“")?s:`âœ“ ${s}`},d))})]}),e.jsx("div",{style:{flexGrow:1}}),(t==null?void 0:t.plan)===n.key&&(t==null?void 0:t.status)==="active"?e.jsx(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",style:{marginTop:"auto"},children:e.jsx(r,{variant:"bodySm",alignment:"center",tone:"subdued",fontWeight:"medium",children:"Current Plan"})}):e.jsx(I,{variant:"primary",fullWidth:!0,onClick:()=>{L(n),v(!0)},children:"Select Plan"})]})},n.key)})})})})}),e.jsx(l.Section,{variant:"oneThird",children:e.jsx(m,{children:e.jsxs(o,{gap:"400",children:[e.jsx(r,{variant:"headingMd",children:"Token Balance"}),e.jsx(B,{}),e.jsxs(o,{gap:"300",children:[e.jsxs(j,{children:[e.jsx(r,{variant:"heading2xl",alignment:"center",children:((z=u==null?void 0:u.balance)==null?void 0:z.toLocaleString())||0}),e.jsx(r,{variant:"bodySm",tone:"subdued",alignment:"center",children:"tokens available"}),(()=>{var g;const n=(g=t==null?void 0:t.plan)==null?void 0:g.toLowerCase().trim(),a=n==="growth extra";if(!a&&!(n==="enterprise"))return null;const d=a?"100M":"300M";return e.jsxs(r,{variant:"bodySm",tone:"subdued",alignment:"center",fontWeight:"medium",children:["(",d," included this cycle)"]})})()]}),e.jsxs(w,{align:"space-between",children:[e.jsx(r,{variant:"bodySm",tone:"subdued",children:(()=>{var a;const n=(a=t==null?void 0:t.plan)==null?void 0:a.toLowerCase().trim();return n==="growth extra"||n==="enterprise"?"Additional Purchased":"Purchased"})()}),e.jsx(r,{variant:"bodySm",children:((G=u==null?void 0:u.totalPurchased)==null?void 0:G.toLocaleString())||0})]}),e.jsxs(w,{align:"space-between",children:[e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Used"}),e.jsx(r,{variant:"bodySm",children:((N=u==null?void 0:u.totalUsed)==null?void 0:N.toLocaleString())||0})]}),e.jsx(B,{}),e.jsx(I,{variant:"primary",fullWidth:!0,onClick:()=>{(t==null?void 0:t.plan)==="starter"?k(!0):T(!0)},children:"Buy Tokens"}),e.jsx(j,{background:"bg-surface-secondary",padding:"300",borderRadius:"200",children:e.jsxs(o,{gap:"100",children:[e.jsx(r,{variant:"bodySm",tone:"subdued",children:"ðŸ’¡ Tokens enable AI features"}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"â™»ï¸ Never expire, roll over monthly"})]})})]})]})})})]}),e.jsx(S,{open:J,onClose:()=>{v(!1),L(null),E(!1)},title:"Confirm Plan Selection",primaryAction:{content:M?"Processing...":"Confirm",loading:M,onAction:()=>Z((p==null?void 0:p.key)||(t==null?void 0:t.plan))},secondaryActions:[{content:"Cancel",onAction:()=>{v(!1),L(null),E(!1)}}],children:e.jsx(S.Section,{children:e.jsxs(o,{gap:"400",children:[e.jsxs(r,{children:["You are about to subscribe to the ",e.jsx("strong",{children:(p==null?void 0:p.name)||(t==null?void 0:t.plan)})," plan."]}),(t==null?void 0:t.inTrial)&&F&&e.jsx(y,{tone:"warning",children:e.jsx("p",{children:"This will end your trial period and start billing immediately."})})]})})}),e.jsx(S,{open:K,onClose:()=>{T(!1),P(""),C(U[0])},title:"Purchase Tokens",primaryAction:{content:M?"Processing...":"Purchase",loading:M,onAction:()=>ee(b||A)},secondaryActions:[{content:"Cancel",onAction:()=>{T(!1),P(""),C(U[0])}}],children:e.jsx(S.Section,{children:e.jsxs(o,{gap:"400",children:[e.jsx(r,{variant:"headingMd",children:"Select Amount"}),e.jsx(ie,{variant:"segmented",children:U.map(n=>e.jsxs(I,{pressed:A===n&&!b,onClick:()=>{C(n),P("")},children:["$",n]},n))}),e.jsx(r,{variant:"bodyMd",tone:"subdued",children:"Or enter a custom amount (multiples of $5)"}),e.jsx(oe,{type:"number",value:b,onChange:n=>{P(n),C(null)},placeholder:"Enter amount",prefix:"$",min:5,step:5,autoComplete:"off"}),e.jsx(j,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(o,{gap:"200",children:[e.jsxs(w,{align:"space-between",children:[e.jsx(r,{variant:"bodyMd",children:"Amount"}),e.jsxs(r,{variant:"bodyMd",fontWeight:"semibold",children:["$",b||A]})]}),e.jsxs(w,{align:"space-between",children:[e.jsx(r,{variant:"bodyMd",children:"Tokens"}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:ne(parseFloat(b||A)).toLocaleString()})]}),e.jsx(B,{}),e.jsx(r,{variant:"bodySm",tone:"subdued",children:"Tokens never expire and roll over indefinitely"})]})}),(t==null?void 0:t.inTrial)&&e.jsx(y,{tone:"info",children:e.jsx("p",{children:"Your trial will continue after purchasing tokens."})})]})})}),e.jsx(S,{open:_,onClose:()=>k(!1),title:"Upgrade Required",primaryAction:{content:"View Plans",onAction:()=>{k(!1),window.scrollTo({top:0,behavior:"smooth"})}},secondaryActions:[{content:"Cancel",onAction:()=>k(!1)}],children:e.jsx(S.Section,{children:e.jsxs(o,{gap:"400",children:[e.jsxs(r,{variant:"bodyLg",children:["Token purchases require ",e.jsx("strong",{children:"Professional"})," plan or higher."]}),e.jsxs(r,{variant:"bodyMd",tone:"subdued",children:["Your current plan: ",e.jsx("strong",{children:"Starter"})]}),e.jsx(j,{background:"bg-surface-secondary",padding:"400",borderRadius:"200",children:e.jsxs(o,{gap:"200",children:[e.jsx(r,{variant:"headingSm",children:"Upgrade to unlock:"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ Token purchases"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ AI-enhanced optimization"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ Store Metadata for AI Search"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ More AI bot access"}),e.jsx(r,{variant:"bodyMd",children:"âœ“ Higher product limits"})]})}),e.jsx(y,{tone:"info",children:e.jsx("p",{children:"Professional plan starts at $15.99/month with up to 250 products."})})]})})})]})}export{ue as default};
