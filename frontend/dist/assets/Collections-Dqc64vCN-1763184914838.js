import{j as e}from"./app-bridge-Dll4AwN--1763184914838.js";import{r as n}from"./react-vendor-tAaa2TlE-1763184914838.js";import{m as Mt}from"./sessionFetch-CJepNHo3-1763184914838.js";import{S as Pt,U as kt}from"./StoreMetadataBanner-D_vTjMcC-1763184914838.js";import{I as It}from"./InsufficientTokensModal-L7j7HThB-1763184914838.js";import{T as Et}from"./TrialActivationModal-BFZpu3mi-1763184914838.js";import{M as S,a as L,T as r,e as me,d as Tt,b as O,B as c,I as w,g as Fe,D as Dt,f as V,C as qe,h as zt,S as Rt,i as _e,j as He,R as $t,k as Ut,m as Bt,E as Nt}from"./polaris-DkgsK6SL-1763184914838.js";const Wt=(le,j="")=>{try{return new URLSearchParams(window.location.search).get(le)||j}catch{return j}};function ms({shop:le,globalPlan:j}){var Be,Ne,We;const d=le||Wt("shop",""),C=n.useMemo(()=>Mt(),[]),[f,Se]=n.useState([]),[xe,je]=n.useState(!1),[_,Ke]=n.useState(0),[g,H]=n.useState([]),[b,X]=n.useState(!1),[Ft,qt]=n.useState(""),[z,ae]=n.useState(""),[M,ee]=n.useState("all"),[_t,Ht]=n.useState(""),[Kt,Jt]=n.useState([]),[Gt,Yt]=n.useState([]),[ye,re]=n.useState(!1),[Zt,Qt]=n.useState(!1),[Vt,Xt]=n.useState(!1),[we,ie]=n.useState(!1),[P,Je]=n.useState("updatedAt"),[k,Ge]=n.useState("desc"),[Ye,Ze]=n.useState(""),[es,Qe]=n.useState([]),[v,B]=n.useState([]),[A,Ce]=n.useState([]),[ce,K]=n.useState(!1),[E,R]=n.useState({current:0,total:0,percent:0}),[be,J]=n.useState(""),[G,ve]=n.useState([]),[ts,ss]=n.useState(!1),[ns,os]=n.useState(null),[ls,as]=n.useState(!1),[rs,Ve]=n.useState(""),[Xe,te]=n.useState(!1),[N,W]=n.useState([]),[Ae,Le]=n.useState(!1),[et,Y]=n.useState(!1),[Oe,Me]=n.useState(!1),[tt,se]=n.useState(!1),[Pe,ne]=n.useState([]),[$,de]=n.useState({}),[st,ue]=n.useState(!1),[nt,he]=n.useState(!1),[ke,is]=n.useState({}),[ot,ge]=n.useState(!1),[Ie,pe]=n.useState(null),[lt,Ee]=n.useState(!1),[Te,m]=n.useState(""),[De,ze]=n.useState(!1),[at,Z]=n.useState(!1),[rt,Re]=n.useState(!1),[it,$e]=n.useState(!1),[p,F]=n.useState(null),[I,Q]=n.useState("starter"),[T,fe]=n.useState(1);n.useEffect(()=>{if(!(!j||typeof j!="object")){if(j.planKey&&j.planKey!==""){Q(j.planKey);const t=j.language_limit||1;fe(t)}else if(j.plan&&j.plan!==""){const t=j.plan.toLowerCase().replace(/\s+/g,"-");Q(t);const s=j.language_limit||1;fe(s)}}},[j]);const[y,U]=n.useState({processing:!1,current:0,total:0,currentItem:"",results:null});n.useEffect(()=>{if(!d)return;C("/graphql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:`
      query PlansMe($shop:String!) {
        plansMe(shop:$shop) {
          plan
          planKey
          modelsSuggested
        }
      }
    `,variables:{shop:d}})}).then(s=>{var a,u,x;if((a=s==null?void 0:s.errors)!=null&&a.length)throw new Error(((u=s.errors[0])==null?void 0:u.message)||"GraphQL error");const o=(x=s==null?void 0:s.data)==null?void 0:x.plansMe,l=(o==null?void 0:o.modelsSuggested)||["google/gemini-1.5-flash"];Qe(l.map(q=>({label:q,value:q}))),Ze(l[0]),Q((o==null?void 0:o.planKey)||"starter");const i=(o==null?void 0:o.language_limit)||1;fe(i)}).catch(s=>m(`Error loading models: ${s.message}`))},[d,C]),n.useEffect(()=>{d&&C(`/api/languages/shop/${d}?shop=${d}`).then(t=>{const s=(t==null?void 0:t.shopLanguages)||["en"];Ce(s),B([])}).catch(t=>{console.error("[COLLECTIONS] Languages API error:",t),Ce(["en"]),B([])})},[d,C]);const ct=async()=>{try{Me(!0);const t=await C(`/api/collections/sync?shop=${d}`,{method:"POST"});t!=null&&t.success?(m("Collections synced successfully!"),await D()):(console.error("[COLLECTIONS] Sync failed:",t),m("Failed to sync collections"))}catch(t){console.error("[COLLECTIONS] Sync error:",t),m("Error syncing collections")}finally{Me(!1)}},D=n.useCallback(async()=>{je(!0);try{const s=`/collections/list-graphql?${new URLSearchParams({shop:d,...z&&{search:z},...M!=="all"&&{optimized:M},sortBy:P,sortOrder:k})}`;let l=(await C(s)).collections||[];if(z){const i=z.toLowerCase();l=l.filter(a=>a.title.toLowerCase().includes(i)||a.handle.toLowerCase().includes(i))}M!=="all"&&(l=l.filter(i=>M==="true"?i.hasSeoData:!i.hasSeoData)),Se(l),Ke(l.length)}catch(t){m(`Error loading collections: ${t.message}`)}finally{je(!1)}},[d,z,M,P,k,C]);n.useEffect(()=>{d&&(D(),Y(!1))},[d,M,P,k,D]),n.useEffect(()=>{const t=setTimeout(()=>{d&&D()},500);return()=>clearTimeout(t)},[z]);const dt=n.useCallback(t=>{H(t);const s=t.some(o=>{const l=f.find(i=>i.id===o);return l==null?void 0:l.hasSeoData});Y(s),t.length===0&&X(!1)},[f]),ut=n.useCallback(t=>{if(X(t),t){H(f.map(o=>o.id));const s=f.some(o=>o.hasSeoData);Y(s)}else H([]),Y(!1)},[f]),ht=async t=>{Ee(!0);try{const s=`/collections/${t.split("/").pop()}/seo-data?shop=${encodeURIComponent(d)}`,o=await C(s);pe(o),ge(!0)}catch(s){m((s==null?void 0:s.status)===404?"No SEO data found for this collection":"Failed to load SEO data")}finally{Ee(!1)}},Ue=n.useMemo(()=>{var s;if(b)return v.length>T;const t=f.filter(o=>g.includes(o.id));if(t.length===0)return v.length>T;for(const o of t){const l=((s=o.optimizationSummary)==null?void 0:s.optimizedLanguages)||[],i=v.filter(u=>!l.includes(u));if(l.length+i.length>T)return!0}return!1},[f,g,b,T,v]),gt=()=>{if(g.length===0&&!b){m("Please select collections first");return}he(!0)},pt=async()=>{const s=f.filter(l=>g.includes(l.id)).filter(l=>{var i;return((i=l.optimizedLanguages)==null?void 0:i.length)>0});if(s.length===0){m("Please select collections with Basic SEO optimization");return}ze(!0),U({processing:!0,current:0,total:s.length,currentItem:"",results:null});const o={successful:0,failed:0,skipped:0};for(let l=0;l<s.length;l++){const i=s[l];U(a=>({...a,current:l,currentItem:i.title}));try{const a=i.optimizedLanguages||[];if(a.length===0){o.skipped++;continue}const u=await C(`/ai-enhance/collection/${encodeURIComponent(i.id)}`,{method:"POST",shop:d,body:{shop:d,languages:a}});u&&u.ok?o.successful++:o.failed++}catch(a){if(a.status===403){U({processing:!1,current:0,total:0,currentItem:"",results:null}),F(a),Q(a.currentPlan||I||"starter"),Z(!0);return}if(a.status===402||a.requiresPurchase||a.trialRestriction){U({processing:!1,current:0,total:0,currentItem:"",results:null}),F(a),Q(a.currentPlan||I||"starter"),a.trialRestriction&&a.requiresActivation?$e(!0):a.trialRestriction?Z(!0):Re(!0);return}o.failed++}U(a=>({...a,current:l+1}))}U(l=>({...l,processing:!1,results:o})),m(`AI enhancement complete! ${o.successful} collections enhanced.`)},ft=()=>{f.filter(o=>g.includes(o.id)).filter(o=>{var l;return((l=o.optimizedLanguages)==null?void 0:l.length)>0});const s=()=>{const o=y.results;ze(!1),U({processing:!1,current:0,total:0,currentItem:"",results:null}),o&&o.successful>0&&setTimeout(()=>{Se([]),D()},1500)};return y.processing?e.jsx(S,{open:De,title:"Processing AI Enhancement",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Processing: ",y.currentItem]}),e.jsx(me,{progress:y.current/y.total*100}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[y.current," of ",y.total," collections (",Math.round(y.current/y.total*100),"%)"]})]})})}):y.results!==null?e.jsx(S,{open:De,title:"AI Enhancement Results",onClose:s,primaryAction:{content:"Done",onAction:s},children:e.jsx(S.Section,{children:e.jsx(L,{gap:"300",children:e.jsxs(w,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:y.results.successful})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:y.results.failed})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:y.results.skipped})]})]})})})}):null},mt=async()=>{var t;if(!v.length){m("Please select at least one language");return}he(!1),K(!0),R({current:0,total:0,percent:0}),ve([]),de({});try{const s=b?f:f.filter(a=>g.includes(a.id)),o=s.length;R({current:0,total:o,percent:0});const l={};for(let a=0;a<s.length;a++){const u=s[a];J(u.title);try{const h=await C("/seo/generate-collection-multi",{method:"POST",shop:d,body:JSON.stringify({shop:d,collectionId:u.id,model:Ye,languages:v})});l[u.id]={success:!0,data:h}}catch(h){if(h.status===403||(t=h.message)!=null&&t.includes("requires Professional plan")){K(!1),J(""),F({error:h.message||"Collections SEO requires Professional plan or higher",currentPlan:h.currentPlan||I||"starter",upgradeMessage:h.upgradeMessage||"Upgrade to Professional plan to optimize collections for AI search"}),Z(!0);return}l[u.id]={success:!1,error:h.message},ve(oe=>[...oe,{collection:u.title,error:h.message}])}const x=a+1,q=Math.round(x/o*100);R({current:x,total:o,percent:q})}de(l),ue(!0);const i=Object.values(l).filter(a=>a.success).length;m(`Generated optimization for ${i} collections`)}catch(s){m(`Error: ${s.message}`)}finally{K(!1),J("")}},St=async()=>{var t;K(!0),R({current:0,total:0,percent:0});try{const s=Object.entries($).filter(([l,i])=>i.success),o=s.length;R({current:0,total:o,percent:0});for(let l=0;l<s.length;l++){const[i,a]=s[l],u=f.find(h=>h.id===i);if(!u)continue;J(u.title);try{if(!((t=a.data)!=null&&t.results)||!Array.isArray(a.data.results))throw new Error("Invalid results structure");const h=await C("/seo/apply-collection-multi",{method:"POST",shop:d,body:{shop:d,collectionId:i,results:a.data.results.map(oe=>({language:oe.language,seo:oe.data})),options:{updateTitle:!0,updateDescription:!0,updateSeo:!0,updateMetafields:!0}}});if(!(h!=null&&h.ok))throw new Error((h==null?void 0:h.error)||"Apply failed")}catch(h){console.error("Apply error for collection:",i,h),G.push({id:u.id,title:u.title,message:h.message})}const x=l+1,q=Math.round(x/o*100);R({current:x,total:o,percent:q})}m("Optimization applied successfully!"),ue(!1),de({}),H([]),await D(),X(!1)}catch(s){m(`Error applying optimization: ${s.message}`)}finally{K(!1),J("")}},xt=async(t=[])=>{Le(!0),Ve("");try{const s=b?f:f.filter(a=>g.includes(a.id)),o=s.length*t.length;let l=0;const i=[];for(const a of s)for(const u of t)try{const x=await C("/collections/delete-seo",{method:"DELETE",shop:d,body:{shop:d,collectionId:a.id,language:u}})}catch(x){console.error(`[DELETE-SEO-BULK] Failed to delete ${u} for ${a.title}:`,x),i.push({id:a.id,title:a.title,message:x.message})}finally{l++,R({current:l,total:o,percent:Math.round(l/o*100)})}m(`Deleted optimization for ${t.join(", ").toUpperCase()}`),setTimeout(async()=>{await D(),H([]),X(!1),Y(!1)},100)}catch(s){console.error("[DELETE-SEO-BULK] Error:",s),m(`Delete error: ${s.message}`)}finally{Le(!1),ne([]),W([])}},jt=t=>{var a,u;const s=((a=$[t.id])==null?void 0:a.success)||ke[t.id],o=((u=$[t.id])==null?void 0:u.data)||ke[t.id],l=t.optimizedLanguages||[],i=e.jsx(c,{width:"40px",height:"40px",background:"surface-neutral",borderRadius:"200"});return e.jsx(Bt,{id:t.id,media:i,accessibilityLabel:`View details for ${t.title}`,children:e.jsxs(w,{gap:"400",align:"center",blockAlign:"center",wrap:!1,children:[e.jsxs(c,{style:{flex:"1 1 30%",minWidth:"200px"},children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:t.title}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["Handle: ",t.handle]})]}),e.jsx(c,{style:{flex:"0 0 15%",minWidth:"100px",textAlign:"center"},children:e.jsxs(r,{variant:"bodyMd",children:[t.productsCount," products"]})}),e.jsx(c,{style:{flex:"0 0 25%",minWidth:"160px"},children:e.jsx(w,{gap:"100",wrap:!0,children:t.hasSeoData?e.jsxs(e.Fragment,{children:[A.map(x=>e.jsx(V,{tone:l.includes(x)?"success":"subdued",size:"small",children:x.toUpperCase()},x)),t.aiEnhanced&&e.jsx(V,{tone:"info",size:"small",children:"AIâœ¨"})]}):e.jsx(V,{tone:"subdued",children:"No AI Search Optimisation"})})}),e.jsxs(c,{style:{flex:"0 0 15%",minWidth:"120px"},children:[s&&e.jsx(O,{size:"slim",onClick:()=>{pe(o),ge(!0)},children:"Preview JSON"}),!s&&t.hasSeoData&&e.jsx(O,{size:"slim",loading:lt,onClick:()=>ht(t.id),children:"Preview JSON"})]})]})})},yt=ce&&!y.processing&&e.jsx(S,{open:ce,title:"Processing Collections",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:be?`Processing: ${be}`:"Preparing..."}),e.jsx(me,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," collections (",E.percent,"%)"]})]})})}),wt=e.jsx(S,{open:nt,title:"Select Languages",primaryAction:{content:"Generate Optimization for AI Search",onAction:mt,disabled:v.length===0||Ue},secondaryActions:[{content:"Cancel",onAction:()=>he(!1)}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"300",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to generate AI Search Optimisation for ",b?"all":g.length," selected collections:"]}),Ue&&e.jsx(Tt,{tone:"warning",title:"Language limit exceeded",children:e.jsxs(L,{gap:"200",children:[e.jsxs(r,{variant:"bodyMd",children:["Your ",I," plan supports up to ",T," language",T>1?"s":""," per collection.",g.length===1&&((We=(Ne=(Be=f.find(t=>t.id===g[0]))==null?void 0:Be.optimizationSummary)==null?void 0:Ne.optimizedLanguages)==null?void 0:We.length)>0&&e.jsxs(e.Fragment,{children:[" This collection already has ",f.find(t=>t.id===g[0]).optimizationSummary.optimizedLanguages.length," optimized language(s)."]})]}),e.jsx(r,{variant:"bodyMd",children:"Please deselect some languages or upgrade your plan to add more:"}),e.jsx(O,{variant:"primary",onClick:()=>{const t=new URLSearchParams(window.location.search),s=t.toString()?`?${t.toString()}`:"";window.location.href=`/billing${s}`},children:"Upgrade Plan"})]})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",wrap:!0,children:A.map(t=>e.jsx(Fe,{label:t.toUpperCase(),checked:v.includes(t),onChange:s=>{B(s?[...v,t]:v.filter(o=>o!==t))}},t))})}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(O,{plain:!0,onClick:()=>{v.length===A.length?B([]):A.length>T?(B([...A]),m(`You selected ${A.length} languages. Your ${I} plan supports ${T}. Please deselect or upgrade.`)):B([...A])},children:v.length===A.length?"Deselect all":"Select all"})})]})})}),Ct=e.jsx(S,{open:st&&!ce,title:"AI Search Optimisation Results",primaryAction:{content:"Apply Optimisation",onAction:St,disabled:!Object.values($).some(t=>t.success)},secondaryActions:[{content:"Cancel",onAction:()=>ue(!1)}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"300",children:[e.jsxs(w,{gap:"400",children:[e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Successful:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"success",children:Object.values($).filter(t=>t.success&&!t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Skipped:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"info",children:Object.values($).filter(t=>t.skipped).length})]}),e.jsxs(c,{children:[e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Failed:"}),e.jsx(r,{variant:"headingLg",fontWeight:"bold",tone:"critical",children:Object.values($).filter(t=>!t.success&&!t.skipped).length})]})]}),G.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Dt,{}),e.jsx(r,{variant:"bodyMd",fontWeight:"semibold",children:"Errors:"}),e.jsxs(c,{maxHeight:"200px",overflowY:"scroll",children:[G.slice(0,10).map((t,s)=>e.jsxs(r,{variant:"bodySm",tone:"critical",children:[t.collection,": ",t.error]},s)),G.length>10&&e.jsxs(r,{variant:"bodySm",tone:"subdued",children:["... and ",G.length-10," more errors"]})]})]})]})})}),bt=e.jsx(S,{open:ot,title:"SEO Data Preview",secondaryActions:[{content:"Close",onAction:()=>{ge(!1),pe(null)}}],children:e.jsx(S.Section,{children:e.jsx(c,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontSize:"12px",backgroundColor:"#f6f6f7",padding:"12px",borderRadius:"4px",maxHeight:"400px",overflow:"auto"},children:Ie?JSON.stringify(Ie,null,2):""})})})}),vt=e.jsx(S,{open:Xe,title:"Delete Optimization for AI Search",onClose:()=>{te(!1),W([])},primaryAction:{content:"Continue",onAction:()=>{ne(N),te(!1),se(!0)},disabled:N.length===0},secondaryActions:[{content:"Cancel",onAction:()=>{te(!1),W([])}}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsxs(r,{variant:"bodyMd",children:["Select languages to delete AI Search Optimisation from ",b?_:g.length," selected collections:"]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"400",wrap:!1,children:A.map(t=>e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",userSelect:"none"},children:[e.jsx("input",{type:"checkbox",checked:N.includes(t),onChange:s=>{W(s.target.checked?[...N,t]:N.filter(o=>o!==t))},style:{marginRight:"8px",width:"18px",height:"18px",cursor:"pointer"}}),e.jsx(r,{variant:"bodyMd",children:t.toUpperCase()})]},t))})}),e.jsx(c,{children:e.jsx(O,{plain:!0,onClick:()=>{W(N.length===A.length?[]:[...A])},children:"Select all"})}),e.jsx(c,{paddingBlockStart:"300",children:e.jsx(r,{variant:"bodySm",children:"Warning: This will permanently delete AI Search Optimisation data for selected languages."})})]})})}),At=e.jsx(S,{open:tt,title:"Confirm Deletion",onClose:()=>{se(!1),ne([])},primaryAction:{content:"Delete",destructive:!0,onAction:async()=>{se(!1),setTimeout(()=>{xt(Pe)},100)}},secondaryActions:[{content:"Cancel",onAction:()=>{se(!1),ne([]),W([])}}],children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Are you sure you want to delete AI Search Optimisation for the following languages?"}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"200",children:Pe.map(t=>e.jsx(V,{tone:"warning",children:t.toUpperCase()},t))})}),e.jsxs(r,{variant:"bodyMd",children:["This will delete optimisation from ",b?_:g.length," selected collections."]}),e.jsx(c,{paddingBlockStart:"200",children:e.jsx(r,{variant:"bodySm",tone:"critical",children:"This action cannot be undone."})})]})})}),Lt=Ae&&e.jsx(S,{open:Ae,title:"Deleting SEO Data",onClose:()=>{},noScroll:!0,children:e.jsx(S.Section,{children:e.jsxs(L,{gap:"400",children:[e.jsx(r,{variant:"bodyMd",children:"Deleting selected languages..."}),e.jsx(me,{progress:E.percent}),e.jsxs(r,{variant:"bodySm",tone:"subdued",children:[E.current," of ",E.total," operations (",E.percent,"%)"]})]})})}),Ot=e.jsx(Nt,{heading:"No collections found",action:{content:"Clear filters",onAction:()=>{ae(""),ee("all"),D()}},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png",children:e.jsx("p",{children:"Try adjusting your filters or search terms"})});return e.jsxs(e.Fragment,{children:[e.jsx(Pt,{globalPlan:j}),e.jsx(qe,{children:e.jsx(c,{padding:"400",children:e.jsxs(L,{gap:"300",children:[e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"center",wrap:!1,children:[e.jsx(c,{minWidth:"400px",children:e.jsx(zt,{label:"",placeholder:"Search by collection name...",value:z,onChange:ae,prefix:e.jsx(Rt,{}),clearButton:!0,onClearButtonClick:()=>ae("")})}),e.jsx(c,{width:"320px",children:e.jsx(O,{primary:!0,onClick:gt,disabled:g.length===0&&!b,size:"medium",fullWidth:!0,children:"Generate Optimization for AI Search"})})]}),e.jsxs(w,{gap:"400",align:"space-between",blockAlign:"start",wrap:!1,children:[e.jsx(O,{onClick:ct,disabled:Oe||xe,size:"medium",children:Oe?"Syncing...":"Sync Collections"}),e.jsx(c,{width:"320px",children:e.jsxs(L,{gap:"200",align:"end",children:[(()=>{if(g.length===0&&!b||!f.filter(l=>g.includes(l.id)).some(l=>{var i;return((i=l.optimizedLanguages)==null?void 0:i.length)>0}))return null;const o=I.toLowerCase().replace(/_/g," ")==="starter";return e.jsx(O,{onClick:o?()=>{F({error:"Collections require Professional plan or higher",message:"Upgrade to Professional plan to access Collections optimization",minimumPlanRequired:"Professional"}),Z(!0)}:pt,disabled:g.length===0&&!b,size:"medium",fullWidth:!0,children:"AI Enhanced add-ons"})})(),e.jsx(O,{outline:!0,destructive:!0,onClick:()=>te(!0),disabled:g.length===0||!et,size:"medium",fullWidth:!0,children:"Delete Optimization for AI Search"})]})})]})]})})}),e.jsx(c,{paddingBlockStart:"400",children:e.jsxs(qe,{children:[e.jsxs(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:[e.jsxs(w,{gap:"200",wrap:!0,align:"space-between",children:[e.jsx(w,{gap:"200",wrap:!0,children:e.jsx(_e,{active:ye,activator:e.jsx(O,{disclosure:"down",onClick:()=>re(!ye),removeUnderline:!0,children:e.jsxs(w,{gap:"100",blockAlign:"center",children:[e.jsx("span",{children:"AI Search Status"}),M!=="all"&&e.jsx(c,{onClick:t=>{t.stopPropagation(),ee("all")},children:e.jsx(r,{as:"span",tone:"subdued",children:"âœ•"})})]})}),onClose:()=>re(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(He,{title:"AI Search Status",titleHidden:!0,choices:[{label:"All collections",value:"all"},{label:"Has AI Search Optimisation",value:"true"},{label:"No AI Search Optimisation",value:"false"}],selected:[M],onChange:t=>{ee(t[0]),re(!1)}})})})}),e.jsx(_e,{active:we,activator:e.jsx(O,{disclosure:"down",onClick:()=>ie(!we),removeUnderline:!0,children:e.jsx(w,{gap:"100",blockAlign:"center",children:e.jsxs("span",{children:[P==="updatedAt"&&k==="desc"&&"Newest first",P==="updatedAt"&&k==="asc"&&"Oldest first",P==="title"&&k==="asc"&&"Name A-Z",P==="title"&&k==="desc"&&"Name Z-A",P==="productsCount"&&k==="desc"&&"Most products",P==="productsCount"&&k==="asc"&&"Least products"]})})}),onClose:()=>ie(!1),children:e.jsx(c,{padding:"300",minWidth:"200px",children:e.jsx(He,{title:"Sort Order",titleHidden:!0,choices:[{label:"Newest first",value:"updatedAt_desc"},{label:"Oldest first",value:"updatedAt_asc"},{label:"Name A-Z",value:"title_asc"},{label:"Name Z-A",value:"title_desc"},{label:"Most products",value:"productsCount_desc"},{label:"Least products",value:"productsCount_asc"}],selected:[`${P}_${k}`],onChange:t=>{const[s,o]=t[0].split("_");Je(s),Ge(o),ie(!1)}})})})]}),M!=="all"&&e.jsx(c,{paddingBlockStart:"200",children:e.jsx(w,{gap:"100",wrap:!0,children:e.jsx(V,{onRemove:()=>ee("all"),children:M==="true"?"Has AI Search Optimisation":"No AI Search Optimisation"})})})]}),_>0&&e.jsx(c,{padding:"400",borderBlockEndWidth:"025",borderColor:"border",children:e.jsx(Fe,{label:`Select all ${_} collections`,checked:b,onChange:ut})}),e.jsx($t,{resourceName:{singular:"collection",plural:"collections"},items:f,renderItem:jt,selectedItems:g,onSelectionChange:dt,selectable:!0,loading:xe,totalItemsCount:_,emptyState:Ot,showHeader:!1},`collections-${f.length}-${g.length}`)]})}),yt,wt,Ct,bt,vt,At,Lt,ft(),e.jsx(kt,{open:at,onClose:()=>Z(!1),featureName:"Collections AI Enhancement",currentPlan:I,errorMessage:(p==null?void 0:p.error)||(p==null?void 0:p.message),minimumPlanRequired:p==null?void 0:p.minimumPlanRequired}),p&&e.jsxs(e.Fragment,{children:[e.jsx(It,{open:rt,onClose:()=>{Re(!1),F(null)},tokensRequired:p.tokensRequired||0,tokensAvailable:p.tokensAvailable||0,tokensNeeded:p.tokensNeeded||0,feature:"ai-seo-collection",shop:d,needsUpgrade:p.needsUpgrade||!1,minimumPlan:p.minimumPlanForFeature||null,currentPlan:p.currentPlan||I,returnTo:"/ai-seo/collections"}),e.jsx(Et,{open:it,onClose:()=>{$e(!1),F(null)},feature:p.feature||"ai-seo-collection",trialEndsAt:p.trialEndsAt,currentPlan:p.currentPlan||I,tokensRequired:p.tokensRequired||0,onActivatePlan:async()=>{try{console.log("[COLLECTIONS] ðŸ”“ Activating plan directly...");const t=await C("/api/billing/activate",{method:"POST",body:JSON.stringify({shop:d,endTrial:!0,returnTo:"/ai-seo/collections"})});if(console.log("[COLLECTIONS] âœ… Activation response:",t),t.requiresApproval&&t.confirmationUrl){console.log("[COLLECTIONS] ðŸ” Redirecting to Shopify approval..."),window.top.location.href=t.confirmationUrl;return}console.log("[COLLECTIONS] âœ… Plan activated, reloading page..."),window.location.reload()}catch(t){console.error("[COLLECTIONS] âŒ Activation failed:",t);const s=new URLSearchParams(window.location.search),o=s.get("host"),l=s.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${l}&host=${encodeURIComponent(o)}`}},onPurchaseTokens:()=>{const t=new URLSearchParams(window.location.search),s=t.get("host"),o=t.get("embedded");window.location.href=`/billing?shop=${encodeURIComponent(d)}&embedded=${o}&host=${encodeURIComponent(s)}&returnTo=${encodeURIComponent("/ai-seo/collections")}`}})]}),Te&&e.jsx(Ut,{content:Te,onDismiss:()=>m("")})]})}export{ms as default};
